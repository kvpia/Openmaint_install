#!/bin/bash

# ================================================================
# Скрипт для перевірки стану всіх встановлених служб.
# ================================================================

# Функція для перевірки статусу служби
check_service_status() {
    local service_name=$1
    echo -n "Перевірка статусу служби $service_name... "
    if systemctl is-active --quiet "$service_name"; then
        echo -e "\033[32mАктивний\033[0m" # Зелений
    else
        echo -e "\033[31mНеактивний\033[0m" # Червоний
    fi
}

echo "--------------------------------------------------------"
echo "Перевірка статусу основних служб..."
echo "--------------------------------------------------------"

# Перевірка PostgreSQL
check_service_status postgresql.service

# Перевірка Alfresco (використання systemd service, якщо встановлено)
# Якщо Alfresco не було встановлено як службу, це може показати 'not-found'
# Якщо ви запускаєте його через .sh-скрипт, він не буде відображатися як системна служба.
# Можливо, вам буде зручніше перевірити процес вручну:
# `pgrep -f alfresco`
echo "Перевірка статусу Alfresco..."
if systemctl is-active --quiet alfresco.service; then
    echo -e "\033[32mАктивний\033[0m"
elif pgrep -f "alfresco" >/dev/null; then
    echo -e "\033[33mАктивний (процес)\033[0m" # Жовтий
else
    echo -e "\033[31mНеактивний\033[0m"
fi

# Перевірка GeoServer
# Ми створили systemd-службу, тому вона має бути активною
check_service_status geoserver.service

# Перевірка OpenMAINT
# Оскільки OpenMAINT не було встановлено як systemd-службу,
# ми перевіряємо його наявність у запущених процесах.
echo "Перевірка статусу OpenMAINT..."
if pgrep -f "cmdbuild" >/dev/null; then
    echo -e "\033[32mАктивний\033[0m"
else
    echo -e "\033[31mНеактивний\033[0m"
fi

echo "--------------------------------------------------------"
echo "Перевірка завершена."
echo "--------------------------------------------------------"
